apiVersion: radix.equinor.com/v1
kind: RadixApplication
metadata:
  name: radix-csi-azure-keyvault-example-satr
spec:
  environments:
    - name: dev
      build:
        from: main
    - name: prod
      build:
        from: release
  components:
    - name: frontend
      src: frontend
      ports:
        - name: http
          port: 8001
      publicPort: http
      variables:
        VAR1: "val1"
        VAR2: "val2"
        VAR3: ""
      runAsNonRoot: true
      environmentConfig:
        - environment: dev
          variables:
            VAR1: "val1"
          secretRefs:
            azureKeyVaults:
              - name: radix-sci-az-kv-test
                items:
                  - name: connection-string-dev
                    envVar: CONNECTION_STRING2
                    type: secret
                  - name: key1
                    envVar: KEY_1
                    type: key
                  - name: key2
                    envVar: KEY_22
                    type: key
        - environment: prod
          variables:
            VAR1: "val1"
          secretRefs:
            azureKeyVaults:
              - name: radix-sci-az-kv-test2
                items:
                  - name: connection-string-2
                    envVar: CONNECTION_STRING_2
                    type: secret
                  - name: key11
                    envVar: KEY_11
                    type: key
                  - name: key22
                    envVar: KEY_22
                    type: key
      secrets:
        - SECRET_A
        - SECRET_B
      secretRefs:
        azureKeyVaults:
          - name: radix-sci-az-kv-test
            items:
              - name: connection-string-dev
                envVar: CONNECTION_STRING
                type: secret
              - name: key1
                envVar: KEY_11
                type: key
              - name: key2
                envVar: KEY_2
                type: key

  dnsAppAlias:
    environment: dev
    component: frontend
